var topRow=[{id:0,customerCount:0,x:184,y:177},{id:1,customerCount:0,x:190,y:238},{id:2,customerCount:0,x:255,y:243},{id:3,customerCount:0,x:305,y:243},{id:4,customerCount:0,x:342,y:243},{id:5,customerCount:0,x:367,y:243},{id:6,customerCount:0,x:395,y:228},{id:7,customerCount:0,x:484,y:215},{id:8,customerCount:0,x:538,y:215},{id:9,customerCount:0,x:580,y:215},{id:10,customerCount:0,x:690,y:168},{id:11,customerCount:0,x:735,y:160},{id:12,customerCount:0,x:825,y:155},{id:13,customerCount:0,x:945,y:155},{id:14,customerCount:0,x:1065,y:155},],bottomRow=[{id:15,customerCount:0,x:182,y:295},{id:16,customerCount:0,x:248,y:295},{id:17,customerCount:0,x:280,y:295},{id:18,customerCount:0,x:315,y:295},{id:19,customerCount:0,x:342,y:295},{id:20,customerCount:0,x:368,y:295},{id:21,customerCount:0,x:392,y:295},{id:22,customerCount:0,x:415,y:295},{id:23,customerCount:0,x:437,y:295},{id:24,customerCount:0,x:460,y:281},{id:25,customerCount:0,x:512,y:266},{id:26,customerCount:0,x:538,y:266},{id:27,customerCount:0,x:574,y:266},{id:28,customerCount:0,x:611,y:266},{id:29,customerCount:0,x:645,y:266},{id:30,customerCount:0,x:695,y:240},{id:31,customerCount:0,x:723,y:231},{id:32,customerCount:0,x:746,y:222},{id:33,customerCount:0,x:788,y:208},{id:34,customerCount:0,x:865,y:200},{id:35,customerCount:0,x:920,y:200},{id:36,customerCount:0,x:955,y:200},{id:37,customerCount:0,x:996,y:200},{id:38,customerCount:0,x:1070,y:200}],doorSensors=topRow.concat(bottomRow),functionAppName="ew-iot",signalRInfoKey="ERfDwHwEDCJpQrAT75oA4xaU9ZXj7vQEUHlex9HIBH3SZaBdvdhQNw==",visualization=function(){"use strict";function y(n){var t=parseInt(n.SensorId),i=parseInt(n.CustomerCount),r=parseInt(n.MaxCapacity);doorSensors[t].customerCount=i;doorSensors[t].maxCapacity=r;doorSensors[t].storeStatus=n.StoreStatus;b(doorSensors[t],n.NotificationType);c()}function p(){var n=new Image;n.onload=function(){t.drawImage(n,0,0);w()};n.src="img/mall-map.png"}function w(){doorSensors.forEach(function(n){u(n.x,n.y,l,n.storeStatus==0?r:o,!0);t.fillStyle="#000000";t.fillText(n.id,n.x-8,n.y+16)})}function b(n,t){var i,f;switch(t){case 0:i=a;break;case 1:i=v;break;case 2:i=r}u(n.x,n.y,e,i,!1);f=n.storeStatus==0?r:o;setTimeout(function(){u(n.x,n.y,e,f,!1)},250)}function u(n,i,r,u,f){t.beginPath();t.arc(n,i,r,0,2*Math.PI);t.fillStyle=u;t.fill();f==!0&&t.stroke()}function k(){var t=s;n.clearRect(0,0,1222,250);n.strokeStyle="#000000";n.lineWidth=.25;doorSensors.forEach(function(r){n.fillText(r.id,t+4,190);n.strokeRect(t,10,i,160);t+=i+h})}function c(){var t=s;doorSensors.forEach(function(r){n.clearRect(t+1,11,i-2,159);var u=parseInt(r.customerCount/r.maxCapacity*159),f=parseInt(r.customerCount/r.maxCapacity*100),e=159-u;n.fillStyle=d(f);n.fillRect(t+1,e+11,i-2,u);t+=i+h})}function d(n){var t,i,r;return n<50?(i=255,t=Math.round(5.1*n)):(t=255,i=Math.round(510-5.1*n)),r=t*65536+i*256+0,"#"+("000000"+r.toString(16)).slice(-6)}function g(){var n=new Chart(f,{type:"line",data:{datasets:[{label:"Total customer-count",data:[],backgroundColor:["rgba(0, 99, 132, 0.2)"],borderColor:["rgba(0,99,132,1)"],borderWidth:2,fill:!0,pointRadius:3}]},options:{legend:{display:!1},tooltips:{enabled:!1},layout:{padding:{left:50}},scales:{xAxes:[{type:"realtime",realtime:{duration:5e4,refresh:2e3,delay:2e3,pause:!1,ttl:36e5,onRefresh:function(n){var t=0,i;doorSensors.forEach(function(n){t+=n.customerCount});i=[{x:Date.now(),y:t}];Array.prototype.push.apply(n.data.datasets[0].data,i)}}}],yAxes:[{ticks:{suggestedMax:25,beginAtZero:!0}}]},plugins:{streaming:{frameRate:20}}}})}function nt(){p();k();c();g()}var t=document.getElementById("mallMap").getContext("2d"),n,f;t.font="10px Arial";n=document.getElementById("customerGraph").getContext("2d");n.font="10px Arial";f=document.getElementById("totalGraph").getContext("2d");const l=6,e=5,o="#00BBFF",r="#001111",a="#00FF00",v="#FF0000",s=60,i=15,h=12;return{init:nt,displayNotification:y}}(),notificationHandler=function(){"use strict";function u(){var t="https://"+functionAppName+".azurewebsites.net/api/SignalRInfo?code="+signalRInfoKey;fetch(t).then(function(n){return n.json()}).then(function(t){var i=t;const r={accessTokenFactory:()=>i.accessToken};n=(new signalR.HubConnectionBuilder).withUrl(i.url,r).build();n.on("SendNotification",function(n){var t=JSON.parse(n);f(t)});n.start().then(function(){console.log("SignalR Connection started!")})}).catch(function(){console.log("Error fecthing connection-info.")})}function f(n){visualization.displayNotification(n)}function e(){visualization.init();u()}var i=document.getElementById("mallMap").getContext("2d"),t,r,n;i.font="10px Arial";t=document.getElementById("customerGraph").getContext("2d");t.font="10px Arial";r=document.getElementById("totalGraph").getContext("2d");return{start:e}}();notificationHandler.start();